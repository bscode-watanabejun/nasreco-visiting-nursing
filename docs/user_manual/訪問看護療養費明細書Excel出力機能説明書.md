# 訪問看護療養費明細書Excel出力機能説明書

## 概要

訪問看護療養費明細書Excel出力機能は、医療保険の利用者について、厚生労働省が定める「訪問看護療養費明細書」のExcel帳票を自動生成する機能です。

この機能により、手作業でExcel帳票を作成する手間を省き、レセプトデータから自動的に帳票を生成できます。

---

## 出力できる条件

以下の条件をすべて満たす場合にのみ、Excel出力が可能です：

1. **医療保険の利用者であること**
   - 介護保険の利用者は対象外です

2. **レセプトが確定済みであること**
   - 未確定のレセプトは出力できません

3. **以下の情報が登録されていること**
   - 患者情報（氏名、生年月日、性別など）
   - 医療保険証情報（保険者番号、被保険者証記号・番号など）
   - 訪問看護指示書（有効期間内の指示書）
   - 訪問記録（対象月の訪問記録）
   - 医療機関情報（指示書を発行した医療機関の情報）

---

## 出力される内容

Excel帳票には、以下の情報が自動的に入力されます。各情報がどのセルに出力されるかを以下に示します。

### セルと出力内容の対応表

#### ヘッダー部分（2行目）

| セル | 出力内容 | 説明 | 実装状況 |
|------|---------|------|---------|
| I2 | 請求年月の年 | レセプトの対象年（例：2025） | ✅ 実装済み |
| L2 | 請求年月の月 | レセプトの対象月（例：1） | ✅ 実装済み |
| Q2 | 都道府県コード | 訪問看護ステーションの都道府県コード（2桁） | ✅ 実装済み |
| U2 | 訪問看護ステーションコード | 施設コード（7桁） | ✅ 実装済み |
| AE2 | （未実装） | 現時点では空欄 | ⚠️ 未実装 |
| AH2 | （未実装） | 現時点では空欄 | ⚠️ 未実装 |
| AK2 | （未実装） | 現時点では空欄 | ⚠️ 未実装 |

#### 保険者情報（7-8行目）

| セル | 出力内容 | 説明 | 実装状況 |
|------|---------|------|---------|
| C7 | 保険者番号 | 医療保険証の保険者番号（8桁） | ✅ 実装済み |
| F7 | 被保険者証記号または番号 | 医療保険証の記号（あれば記号、なければ番号） | ✅ 実装済み |
| G8 | 枝番 | 資格確認レコードの枝番（通常は"01"） | ✅ 実装済み |
| I7 | 実日数 | 対象月の訪問日数（重複日を除く） | ✅ 実装済み |
| K7 | 合計金額 | レセプトの合計金額（円） | ✅ 実装済み |
| U7 | 第1公費の一部負担金額 | 公費併用の場合、第1公費の一部負担金額をカッコ付きで表示 | ✅ 実装済み |
| U8 | 一部負担金額 | 利用者が負担する金額<br>減額の場合：「減額」+ 減額割合または減額金額<br>免除の場合：「免除」<br>支払猶予の場合：「猶予」 | ✅ 実装済み |

#### 公費情報（9-12行目）

公費併用の場合、最大4つまでの公費情報を出力します。

| セル | 出力内容 | 説明 | 実装状況 |
|------|---------|------|---------|
| C9 | 第1公費の負担者番号 | 第1公費の負担者番号（8桁） | ✅ 実装済み |
| F9 | 第1公費の受給者番号 | 第1公費の受給者番号（7桁） | ✅ 実装済み |
| I9 | 第1公費の実日数 | 第1公費の対象となる訪問日数 | ✅ 実装済み |
| K9 | 第1公費の合計金額 | 第1公費の合計金額（円） | ✅ 実装済み |
| U9 | 第1公費の一部負担金額 | 第1公費の一部負担金額（円） | ✅ 実装済み |
| C10 | 第2公費の負担者番号 | 第2公費の負担者番号（8桁） | ✅ 実装済み |
| F10 | 第2公費の受給者番号 | 第2公費の受給者番号（7桁） | ✅ 実装済み |
| I10 | 第2公費の実日数 | 第2公費の対象となる訪問日数 | ✅ 実装済み |
| K10 | 第2公費の合計金額 | 第2公費の合計金額（円） | ✅ 実装済み |
| U10 | 第2公費の一部負担金額 | 第2公費の一部負担金額（円） | ✅ 実装済み |
| C11 | 第3公費の負担者番号 | 第3公費の負担者番号（8桁） | ✅ 実装済み |
| F11 | 第3公費の受給者番号 | 第3公費の受給者番号（7桁） | ✅ 実装済み |
| I11 | 第3公費の実日数 | 第3公費の対象となる訪問日数 | ✅ 実装済み |
| K11 | 第3公費の合計金額 | 第3公費の合計金額（円） | ✅ 実装済み |
| U11 | 第3公費の一部負担金額 | 第3公費の一部負担金額（円） | ✅ 実装済み |
| C12 | 第4公費の負担者番号 | 第4公費の負担者番号（8桁） | ✅ 実装済み |
| F12 | 第4公費の受給者番号 | 第4公費の受給者番号（7桁） | ✅ 実装済み |
| I12 | 第4公費の実日数 | 第4公費の対象となる訪問日数 | ✅ 実装済み |
| K12 | 第4公費の合計金額 | 第4公費の合計金額（円） | ✅ 実装済み |
| U12 | 第4公費の一部負担金額 | 第4公費の一部負担金額（円） | ✅ 実装済み |

#### 特記事項（14行目、16行目）

| セル | 出力内容 | 説明 | 実装状況 |
|------|---------|------|---------|
| A14 | レセプト特記 | レセプト特記コードに対応する名称 | ⚠️ 未実装 |
| F14 | 職務上の事由 | 職務上の事由コードに対応する名称 | ⚠️ 未実装 |
| K14 | 給付割合 | 給付割合を変換して表示（例：070 → 7、080 → 8）<br>国保の場合のみ表示 | ✅ 実装済み |
| K16 | 一部負担金区分 | 一部負担金区分を変換して表示<br>1 → 「低２」<br>3 → 「低１」 | ✅ 実装済み |

#### 医療機関情報（5行目、9行目、12行目、14行目、16行目）

| セル | 出力内容 | 説明 | 実装状況 |
|------|---------|------|---------|
| AD5 | 施設情報 | 施設の住所 + 訪問看護ステーション名称 + 電話番号（改行区切り） | ✅ 実装済み |
| AD9 | 医療機関名称 | 訪問看護指示書を発行した医療機関名 | ✅ 実装済み |
| AD12 | 医療機関都道府県 | 医療機関の所在地の都道府県コード | ✅ 実装済み |
| AF12 | 医療機関点数表 | 点数表コード（通常は"6"=訪問看護） | ✅ 実装済み |
| AH12 | 医療機関コード | 医療機関のコード（7桁） | ✅ 実装済み |
| AC14 | 主治医氏名 | 指示書を発行した医師の氏名 | ✅ 実装済み |
| AF16 | 主治医への直近報告年月日 | 主治医に報告した最新の日付（和暦形式、例：5 令6・1・15） | ✅ 実装済み |

#### 利用者情報（18-22行目）

| セル | 出力内容 | 説明 | 実装状況 |
|------|---------|------|---------|
| B18 | 氏名（カナ） | 利用者のカタカナ氏名 | ✅ 実装済み |
| B19 | 氏名（漢字） | 利用者の漢字氏名（姓 + 名） | ✅ 実装済み |
| I20 | 男女区分 | 性別を表示<br>1 → 「1 男」<br>2 → 「2 女」 | ✅ 実装済み |
| K20 | 生年月日 | 和暦形式で表示（例：3 昭32・2・22生）<br>元号コード + 元号名 + 年・月・日 + 生 | ✅ 実装済み |
| S18 | 訪問した場所1 | 最初の訪問記録の訪問場所名称<br>場所コード99の場合は、S19セルに詳細を表示 | ✅ 実装済み |
| S19 | 訪問場所詳細 | 場所コード99の場合のみ、訪問場所の詳細を表示 | ✅ 実装済み |
| B22 | 情報欄 | 訪問開始年月日、訪問終了情報、死亡情報、指示期間、訪問場所変更履歴などを表示<br>詳細は「情報欄の出力内容」を参照 | ✅ 実装済み（Phase 1） |

#### 訪問日の記号表示（22-38行目）

対象月の各訪問日（1日～31日）に、訪問の種類や条件に応じた記号が自動的に表示されます。

| 訪問日 | セル | 訪問日 | セル | 訪問日 | セル | 実装状況 |
|--------|------|--------|------|--------|------|---------|
| 1日 | S22 | 12日 | AE26 | 23日 | V34 | ✅ 実装済み |
| 2日 | V22 | 13日 | AH26 | 24日 | Y34 | ✅ 実装済み |
| 3日 | Y22 | 14日 | AK26 | 25日 | AB34 | ✅ 実装済み |
| 4日 | AB22 | 15日 | S30 | 26日 | AE34 | ✅ 実装済み |
| 5日 | AE22 | 16日 | V30 | 27日 | AH34 | ✅ 実装済み |
| 6日 | AH22 | 17日 | Y30 | 28日 | AK34 | ✅ 実装済み |
| 7日 | AK22 | 18日 | AB30 | 29日 | S38 | ✅ 実装済み |
| 8日 | S26 | 19日 | AE30 | 30日 | V38 | ✅ 実装済み |
| 9日 | V26 | 20日 | AH30 | 31日 | Y38 | ✅ 実装済み |
| 10日 | Y26 | 21日 | AK30 | | | ✅ 実装済み |
| 11日 | AB26 | 22日 | S34 | | | ✅ 実装済み |

**記号の意味**：

- **○**: 1日に1回の訪問
- **◎**: 1日に2回の訪問
- **◇**: 1日に3回以上の訪問
- **☆**: 専門管理加算が適用された訪問、または専門の研修を受けた看護師による訪問
- **△**: 特別訪問看護指示に基づく訪問
- **□**: 長時間訪問看護加算が適用された訪問
- **▽**: 複数名訪問看護加算が適用された訪問
- **▲**: その他の加算が適用された訪問
- **▼**: 訪問看護基本療養費以外の訪問

**注意**: 同一日に複数の記号が該当する場合は、優先順位に従って表示されます（◇ > ◎ > ○）。その他の記号は重複して表示される場合があります。

---

## 実装状況の凡例

- ✅ **実装済み**: データが自動的に出力されます
- ⚠️ **未実装**: 現時点では空欄のままです（今後の実装予定）

---

## 出力方法

### 手順

1. **レセプト一覧画面**から、出力したいレセプトを選択して詳細画面を開きます

2. レセプト詳細画面の右上にある**「訪問看護療養費明細書Excel出力」**ボタンをクリックします

3. Excelファイルの生成が完了すると、自動的にダウンロードが開始されます

4. ダウンロードされたExcelファイルを開いて、内容を確認します

### ファイル名

ダウンロードされるExcelファイルの名前は、以下の形式です：

```
receipt_YYYYMM_患者番号.xlsx
```

例：`receipt_202501_00001.xlsx`（2025年1月分、患者番号00001のレセプト）

---

## 注意事項

### 出力できない場合

以下の場合、Excel出力ができません：

- レセプトが未確定の場合
- 必要な情報が不足している場合（患者情報、保険証情報、訪問記録など）
- 有効な訪問看護指示書が登録されていない場合
- 医療機関情報が登録されていない場合

エラーメッセージが表示された場合は、内容を確認して必要な情報を登録してください。

### データの反映について

- Excel出力は、**出力時点のデータ**を基に生成されます
- 出力後にデータを変更しても、既にダウンロードしたExcelファイルには反映されません
- データを変更した場合は、再度Excel出力を実行してください

### 不明なセルについて

Excel帳票の一部のセル（AE2、AH2、AK2）については、現時点では空欄のままです。これらのセルについては、今後の仕様確認後に実装予定です。

### 情報欄（B22セル）の出力内容

B22セルには、以下の情報が自動的に出力されます（Phase 1実装項目）：

#### エ: 訪問開始年月日・訪問終了年月日・訪問終了時刻・訪問終了の状況
- **訪問開始年月日**: 最初の訪問記録の日付（和暦形式）
- **訪問終了年月日**: 訪問終了フラグが設定されている訪問記録の日付（和暦形式）
- **訪問終了時刻**: 訪問終了時の終了時刻（全角数字、例：１５時　５分）
- **訪問終了の状況**: 訪問終了の理由（別表15のコードに対応）
  - 01: 軽快
  - 02: 施設
  - 03: 医療機関
  - 04: 死亡
  - 99: その他（文字データも表示）

#### オ: 死亡年月日・死亡時刻・死亡した場所
- **死亡年月日**: 患者の死亡日（和暦形式）
- **死亡時刻**: 死亡時刻（全角数字、例：１５時　５分）
- **死亡した場所**: 死亡場所コード（別表16）に対応する名称
  - コード99（その他）の場合は、文字データも表示

#### ウ: 指示期間
- **指示期間**: 訪問看護指示書の有効期間（和暦形式）
- 指示区分に応じて、以下のタイトルが表示されます：
  - 通常の指示: `<指示期間>`
  - 特別指示: `<特別指示期間>`
  - 精神科指示: `<精神指示期間>`
  - 精神科特別指示: `<精神特別指示期間>`
  - 医療観察精神指示: `<医療観察精神指示期間>`
  - 医療観察精神特別指示: `<医療観察精神特別指示期間>`

#### コ: 訪問した場所２・３
- **訪問した場所２**: 同一月内で訪問場所が変更された場合、2件目の場所情報を表示
- **訪問した場所３**: 同一月内で訪問場所が変更された場合、3件目の場所情報を表示
- 各場所について、以下の情報を表示：
  - 訪問場所変更年月日（和暦形式）
  - 訪問場所コード（別表16）に対応する名称
  - コード99（その他）の場合は、文字データも表示

**注意**: 各セクションは、該当する情報がある場合のみ表示されます。情報がない場合は、そのセクションは表示されません。

**将来実装予定（Phase 2以降）**:
以下の項目は、将来的に実装予定です：
- ア: 主たる傷病名
- イ: 心身の状態
- カ: 情報提供先
- キ: 特記事項
- ク: 専門の研修
- ケ: 他の訪問看護ステーション
- サ: その他

### 給付割合について

給付割合（K14セル）は、**国民健康保険（国保）の場合のみ**自動的に計算して表示されます。

- **国保の場合**: 負担割合から給付割合を計算（給付割合 = 100 - 負担割合）
  - 例: 負担割合3割（30%）→ 給付割合7割（70%）→ 表示: "7"
  - 例: 負担割合2割（20%）→ 給付割合8割（80%）→ 表示: "8"
- **社会保険（社保）の場合**: 給付割合は表示されません（空欄）

給付割合は、保険証に登録されている負担割合から自動的に計算されるため、手動で入力する必要はありません。

### 訪問日の記号について

訪問日の記号は、訪問記録のサービスコードと訪問看護療養費マスタの情報を基に自動的に判定されます。記号が表示されない場合は、以下の可能性があります：

- 訪問記録にサービスコードが設定されていない
- 訪問看護療養費マスタに該当する記号の設定がない

---

## よくある質問

### Q1. 介護保険の利用者でもExcel出力できますか？

A. いいえ、医療保険の利用者のみExcel出力に対応しています。介護保険の利用者の場合は、ボタンが表示されません。

### Q2. 複数のレセプトを一度に出力できますか？

A. 現時点では、1件ずつ出力する仕様です。複数レセプトの一括出力機能は、今後の実装予定です。

### Q3. Excelファイルを編集できますか？

A. はい、ダウンロードしたExcelファイルは自由に編集できます。ただし、編集した内容はシステムには反映されません。

### Q4. 訪問日の記号が表示されない日があります

A. 訪問記録が登録されていない日や、記号の条件を満たさない訪問の場合は、記号が表示されません。これは正常な動作です。

### Q5. 一部負担金額に「減額」「免除」「猶予」と表示されるのは？

A. 医療保険証の減免情報が登録されている場合に表示されます。減額の場合は減額割合または減額金額も表示されます。

---

## 関連機能

- **医療保険レセプトCSV出力**: オンライン請求用のCSVファイルを出力する機能
- **レセプト詳細画面**: レセプトの詳細情報を確認・編集する画面

---

**最終更新日**: 2025年12月

**更新履歴**:
- 2025年12月: B22（情報欄）のPhase 1実装を完了（エ、オ、ウ、コの4項目）
- 2025年11月29日: K14（給付割合）の実装を完了

