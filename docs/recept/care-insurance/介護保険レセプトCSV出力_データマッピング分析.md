# 介護保険レセプトCSV出力 データマッピング分析

## 概要
現在保持しているデータベースのデータで、介護保険レセプトCSV出力仕様書の各項目が出力可能かどうかを分析したドキュメントです。

## 分析対象レコード

1. コントロールレコード（種別:1）
2. 7111（介護給付費請求書情報）
3. 7131基本情報レコード（01）
4. 7131明細情報レコード（02）
5. 7131集計情報レコード（10）
6. エンドレコード（種別:3）

---

## 1. コントロールレコード（種別:1）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 1 | レコード種別 | ○ | 固定値「1」 | ✅ 可能 | - |
| 2 | レコード番号 | ○ | 計算値（連番） | ✅ 可能 | - |
| 3 | ボリューム通番 | ○ | 固定値「0」 | ✅ 可能 | - |
| 4 | レコード件数 | ○ | 計算値（データレコード総数） | ✅ 可能 | - |
| 5 | データ種別 | ○ | 固定値「711」 | ✅ 可能 | - |
| 6 | 福祉事務所特定番号 | ○ | 固定値「0」 | ✅ 可能 | - |
| 7 | 保険者番号 | ○ | 固定値「0」 | ✅ 可能 | - |
| 8 | 事業所番号 | ○ | `facilities.facilityCode` | ⚠️ 要確認 | 10桁の事業所番号が必要。現在は7桁の`facilityCode`を10桁にパディングする処理を実装済み（推測実装） |
| 9 | 都道府県番号 | ○ | `facilities.prefectureCode` | ✅ 可能 | 2桁の都道府県コード |
| 10 | 媒体区分 | ○ | 固定値「4」（FDまたはCD-R） | ✅ 可能 | - |
| 11 | 処理対象年月 | ○ | リクエストパラメータ | ✅ 可能 | - |
| 12 | ファイル管理番号 | ○ | 固定値「0」または「1」 | ✅ 可能 | - |
| 13 | ブランク | ○ | 改行（CR+LF） | ✅ 可能 | - |

**必須項目の出力可否**: ✅ すべて可能（事業所番号は推測実装済みのため要確認）

---

## 2. 7111（介護給付費請求書情報）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 1 | 交換情報識別番号 | ○ | 固定値「7111」 | ✅ 可能 | - |
| 2 | サービス提供年月 | ○ | リクエストパラメータ | ✅ 可能 | - |
| 3 | 事業所番号 | ○ | `facilities.facilityCode` | ⚠️ 要確認 | 10桁の事業所番号が必要。現在は7桁の`facilityCode`を10桁にパディングする処理を実装済み（推測実装） |
| 4 | 保険・公費等区分コード | ○ | 判定ロジック | ✅ 可能 | 公費情報の有無で判定 |
| 5 | 法別番号 | ○ | 公費情報から取得 | ✅ 実装済み | `publicExpenseCards.legalCategoryNumber`。**実装済み**: 法別番号ごとに複数の7111レコードを出力するように実装済み。患者を法別番号ごとにグループ化し（公費がない場合は法別番号「0」）、各法別番号ごとに7111レコードを生成している |
| 6 | 請求情報区分コード | ○ | 判定ロジック | ✅ 可能 | 保険請求:0、公費請求:12 |
| 7 | サービス費用_件数 | ○ | `monthlyReceipts`から集計 | ✅ 可能 | 介護保険のレセプト件数 |
| 8 | サービス費用_単位数 | ○ | `monthlyReceipts.totalPoints`から集計 | ✅ 可能 | - |
| 9 | サービス費用_費用合計 | ○ | `monthlyReceipts.totalAmount`から集計 | ✅ 可能 | - |
| 10 | サービス費用_保険請求額 | ○ | 計算値 | ✅ 可能 | 費用合計 × 給付率 |
| 11 | サービス費用_公費請求額 | ○ | 計算値 | ✅ 可能 | 公費情報から計算 |
| 12 | サービス費用_利用者負担 | ○ | 計算値 | ✅ 可能 | 費用合計 - 保険請求額 - 公費請求額 |
| 13-18 | 特定入所者介護サービス費等 | - | 固定値「0」または空欄 | ✅ 可能 | 訪問看護では不要 |

**必須項目の出力可否**: ✅ すべて可能（事業所番号は推測実装済みのため要確認）

---

## 3. 7131基本情報レコード（01）- 全56項目

### 基本情報（項番1-6）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 1 | 交換情報識別番号 | ○ | 固定値「7131」 | ✅ 可能 | - |
| 2 | レコード種別コード | ○ | 固定値「01」 | ✅ 可能 | - |
| 3 | サービス提供年月 | ○ | リクエストパラメータ | ✅ 可能 | - |
| 4 | 事業所番号 | ○ | `facilities.facilityCode` | ⚠️ 要確認 | 10桁の事業所番号が必要。現在は7桁の`facilityCode`を10桁にパディングする処理を実装済み（推測実装） |
| 5 | 証記載保険者番号 | ○ | `insuranceCards.insurerNumber` | ✅ 可能 | 8桁。データ取得時に8桁にパディングする処理を実装済み |
| 6 | 被保険者番号 | ○ | `insuranceCards.insuredNumber` | ✅ 可能 | 10桁。データ取得時に10桁にパディングする処理を実装済み |

### 公費情報（項番7-12）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 7 | 公費1 負担者番号 | - | `publicExpenseCards.beneficiaryNumber` (priority=1) | ✅ 可能 | 8桁 |
| 8 | 公費1 受給者番号 | - | `publicExpenseCards.recipientNumber` (priority=1) | ✅ 可能 | 7桁。登録している受給者番号をそのまま出力 |
| 9 | 公費2 負担者番号 | - | `publicExpenseCards.beneficiaryNumber` (priority=2) | ✅ 可能 | 8桁 |
| 10 | 公費2 受給者番号 | - | `publicExpenseCards.recipientNumber` (priority=2) | ✅ 可能 | 7桁。登録している受給者番号をそのまま出力 |
| 11 | 公費3 負担者番号 | - | `publicExpenseCards.beneficiaryNumber` (priority=3) | ✅ 可能 | 8桁 |
| 12 | 公費3 受給者番号 | - | `publicExpenseCards.recipientNumber` (priority=3) | ✅ 可能 | 7桁。登録している受給者番号をそのまま出力 |

### 被保険者情報（項番13-18）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 13 | 生年月日 | ○ | `patients.dateOfBirth` | ✅ 可能 | YYYYMMDD形式に変換 |
| 14 | 性別コード | ○ | `patients.gender` | ✅ 可能 | male→1, female→2 に変換 |
| 15 | 要介護状態区分コード | ○ | `patients.careLevel` | ✅ 可能 | support1→11, support2→12, care1→21, care2→22, care3→23, care4→24, care5→25 |
| 16 | 旧措置入所者特例コード | ○ | 固定値「1」 | ✅ 可能 | データベースに該当フィールドなし。固定値「1」（無し）を設定済み |
| 17 | 認定有効期間 開始年月日 | ○ | `insuranceCards.validFrom` | ✅ 可能 | 保険証情報の有効期間開始日を出力 |
| 18 | 認定有効期間 終了年月日 | ○ | `insuranceCards.validUntil` | ✅ 可能 | 保険証情報の有効期限を出力 |

### 居宅サービス計画情報（項番19-20）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 19 | 居宅サービス計画作成区分コード | ○ | 固定値「1」 | ✅ 可能 | データベースに作成者区分フィールドなし。固定値「1」（居宅介護支援事業所作成）を設定済み |
| 20 | 居宅介護支援事業所番号 | 条件付き | 仮値「0000000000」 | ⚠️ 要確認 | データベースに該当フィールドなし。仮値10桁「0000000000」を設定済み（推測実装） |

### サービス期間情報（項番21-28）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 21 | 開始年月日 | ○ | `serviceCarePlans.planPeriodStart` または訪問記録の最初の日付 | ✅ 可能 | 居宅サービス計画の`planPeriodStart`を優先し、なければ訪問記録の最初の日付を使用 |
| 22 | 中止年月日 | - | 訪問記録の最終日付または患者の`isActive`フラグ | ⚠️ 要確認 | サービス中止日を特定するロジックが必要 |
| 23 | 中止理由・入所(院)前の状況コード | - | ❌ データなし | ❌ **不可** | データベースに該当フィールドなし |
| 24 | 入所(院)年月日 | - | `patients.isInHospital`または`patients.isInShortStay`から判定 | ⚠️ 要確認 | 訪問看護では通常不要だが、短期入所時の日付が必要 |
| 25 | 退所(院)年月日 | - | 訪問記録から判定 | ⚠️ 要確認 | 訪問看護では通常不要 |
| 26 | 入所(院)実日数 | - | 計算値 | ⚠️ 要確認 | 訪問看護では通常0 |
| 27 | 外泊日数 | - | ❌ データなし | ❌ **不可** | 訪問看護では不要 |
| 28 | 退所(院)後の状態コード | - | ❌ データなし | ❌ **不可** | 訪問看護では不要 |

### 給付率情報（項番29-32）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 29 | 保険給付率 | ○ | `insuranceCards.copaymentRate`から計算 | ✅ 可能 | 1割負担→90, 2割負担→80, 3割負担→70 |
| 30 | 公費1給付率 | - | 固定値「0」 | ⚠️ 要確認 | 公費の給付率を計算するロジックが必要。現在は簡易実装で固定値「0」を設定済み（推測実装） |
| 31 | 公費2給付率 | - | 固定値「0」 | ⚠️ 要確認 | 公費の給付率を計算するロジックが必要。現在は簡易実装で固定値「0」を設定済み（推測実装） |
| 32 | 公費3給付率 | - | 固定値「0」 | ⚠️ 要確認 | 公費の給付率を計算するロジックが必要。現在は簡易実装で固定値「0」を設定済み（推測実装） |

### 合計情報（項番33-56）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 33 | 合計情報 サービス単位数 | ○ | `monthlyReceipts.totalPoints` | ✅ 可能 | - |
| 34 | 合計情報 請求額 | ○ | `monthlyReceipts.totalAmount`から計算 | ✅ 可能 | 保険請求額 |
| 35 | 合計情報 利用者負担額 | ○ | 計算値 | ✅ 可能 | 費用合計 - 保険請求額 |
| 36-38 | 保険 緊急時施設療養費等 | - | 固定値「0」 | ✅ 可能 | 訪問看護では不要 |
| 39-56 | 公費1-3の各種合計 | - | 公費情報から計算 | ⚠️ 要確認 | 公費が存在する場合のみ計算 |

**必須項目の出力可否**: 
- ✅ 出力可能: 約40項目
- ⚠️ 要確認（推測実装済み）: 3項目（事業所番号、居宅介護支援事業所番号、公費給付率）
- ❌ 出力不可: 3項目（居宅介護支援事業所番号は仮値で対応済み、中止理由コードはデータなし）

---

## 4. 7131明細情報レコード（02）- 全18項目

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 1 | 交換情報識別番号 | ○ | 固定値「7131」 | ✅ 可能 | - |
| 2 | レコード種別コード | ○ | 固定値「02」 | ✅ 可能 | - |
| 3 | サービス提供年月 | ○ | リクエストパラメータ | ✅ 可能 | - |
| 4 | 事業所番号 | ○ | `facilities.facilityCode` | ⚠️ 要確認 | 10桁の事業所番号が必要。現在は7桁の`facilityCode`を10桁にパディングする処理を実装済み（推測実装） |
| 5 | 証記載保険者番号 | ○ | `insuranceCards.insurerNumber` | ✅ 可能 | 8桁。データ取得時に8桁にパディングする処理を実装済み |
| 6 | 被保険者番号 | ○ | `insuranceCards.insuredNumber` | ✅ 可能 | 10桁。データ取得時に10桁にパディングする処理を実装済み |
| 7 | サービス種類コード | ○ | `nursingServiceCodes.serviceCode`から抽出（先頭2桁） | ✅ 可能 | 13=訪問看護, 16=介護予防訪問看護 |
| 8 | サービス項目コード | ○ | `nursingServiceCodes.serviceCode`から抽出（後4桁） | ✅ 可能 | 6桁のサービスコードから4桁を抽出 |
| 9 | 単位数 | ○ | `nursingServiceCodes.points` | ✅ 可能 | サービスコードマスタから取得 |
| 10 | 日数・回数 | ○ | 訪問記録の回数を集計 | ✅ 可能 | 同一サービス項目コードの訪問回数 |
| 11-13 | 公費1-3対象日数・回数 | - | 公費情報から判定 | ⚠️ 要確認 | 公費が存在する場合のみ計算 |
| 14 | サービス単位数 | ○ | 単位数 × 回数 | ✅ 可能 | 計算値 |
| 15-17 | 公費1-3対象サービス単位数 | - | 公費情報から計算 | ⚠️ 要確認 | 公費が存在する場合のみ計算 |
| 18 | 摘要 | - | ❌ データなし | ❌ **不可** | 訪問看護では通常不要だが、仕様上は任意 |

**必須項目の出力可否**: ✅ すべて可能（事業所番号は推測実装済みのため要確認）

---

## 5. 7131集計情報レコード（10）- 全38項目

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 1 | 交換情報識別番号 | ○ | 固定値「7131」 | ✅ 可能 | - |
| 2 | レコード種別コード | ○ | 固定値「10」 | ✅ 可能 | - |
| 3 | サービス提供年月 | ○ | リクエストパラメータ | ✅ 可能 | - |
| 4 | 事業所番号 | ○ | `facilities.facilityCode` | ⚠️ 要確認 | 10桁の事業所番号が必要。現在は7桁の`facilityCode`を10桁にパディングする処理を実装済み（推測実装） |
| 5 | 証記載保険者番号 | ○ | `insuranceCards.insurerNumber` | ✅ 可能 | 8桁。データ取得時に8桁にパディングする処理を実装済み |
| 6 | 被保険者番号 | ○ | `insuranceCards.insuredNumber` | ✅ 可能 | 10桁。データ取得時に10桁にパディングする処理を実装済み |
| 7 | サービス種類コード | ○ | `nursingServiceCodes.serviceCode`から抽出（先頭2桁） | ✅ 可能 | 13=訪問看護, 16=介護予防訪問看護 |
| 8 | サービス実日数 | - | 訪問記録から計算 | ✅ 可能 | 訪問看護では訪問回数と同一。サービス種類コードごとに訪問回数を集計 |
| 9 | 計画単位数 | - | ❌ データなし | ❌ **不可** | 居宅サービス計画の計画単位数が必要だが、データベースに該当フィールドなし |
| 10 | 限度額管理対象単位数 | - | ❌ データなし | ❌ **不可** | データベースに該当フィールドなし |
| 11 | 限度額管理対象外単位数 | - | ❌ データなし | ❌ **不可** | データベースに該当フィールドなし |
| 12-13 | 短期入所計画日数・実日数 | - | 固定値「0」 | ✅ 可能 | 訪問看護では不要 |
| 14 | 保険 単位数合計 | ○ | 明細情報レコードから集計 | ✅ 可能 | - |
| 15 | 保険 単位数単価 | ○ | 固定値「1000」（1単位=10円） | ✅ 可能 | 介護保険の単位数単価 |
| 16 | 保険 請求額 | ○ | 単位数合計 × 単位数単価 × 給付率 | ✅ 可能 | 計算値 |
| 17 | 保険 利用者負担額 | ○ | 単位数合計 × 単位数単価 × 負担率 | ✅ 可能 | 計算値 |
| 18-26 | 公費1-3の各種合計 | - | 公費情報から計算 | ⚠️ 要確認 | 公費が存在する場合のみ計算 |
| 27-38 | 出来高医療費関連 | - | 固定値「0」 | ✅ 可能 | 訪問看護では不要 |

**必須項目の出力可否**: 
- ✅ 出力可能: 14項目
- ⚠️ 要確認: 4項目
- ❌ 出力不可: 3項目（計画単位数、限度額管理対象単位数、限度額管理対象外単位数）

---

## 6. エンドレコード（種別:3）

| 項番 | 項目名 | 必須 | データソース | 出力可否 | 備考 |
|------|--------|------|------------|---------|------|
| 1 | レコード種別 | ○ | 固定値「3」 | ✅ 可能 | - |
| 2 | レコード番号 | ○ | 計算値（最終番号） | ✅ 可能 | - |
| 3 | ブランク | ○ | 改行（CR+LF） | ✅ 可能 | - |

**必須項目の出力可否**: ✅ すべて可能

---

## まとめ

### 必須項目の出力可否サマリー

| レコードタイプ | 必須項目数 | 出力可能 | 要確認（推測実装済み） | 出力不可 |
|--------------|----------|---------|---------------------|---------|
| コントロールレコード | 13 | 12 | 1（事業所番号） | 0 |
| 7111 | 12 | 12 | 1（事業所番号） | 0 |
| 7131基本情報（01） | 約20項目 | 約20項目 | 2項目（事業所番号、居宅介護支援事業所番号） | 1項目（中止理由コードはデータなし） |
| 7131明細情報（02） | 14 | 14 | 1（事業所番号） | 0 |
| 7131集計情報（10） | 7 | 7 | 1（事業所番号） | 3項目（計画単位数、限度額管理対象単位数、限度額管理対象外単位数） |
| エンドレコード | 3 | 3 | 0 | 0 |

### 主な課題

1. **事業所番号（10桁）**: 現在`facilities.facilityCode`は7桁のみ。10桁の事業所番号が必要。**実装済み**: 7桁の`facilityCode`を10桁にパディングする処理を実装（推測実装のため要確認）
2. **7111レコードの法別番号**: **実装済み**: 法別番号ごとに複数の7111レコードを出力するように実装済み。患者を法別番号ごとにグループ化し（公費がない場合は法別番号「0」）、各法別番号ごとに7111レコードを生成している
3. **居宅介護支援事業所番号**: データベースに該当フィールドなし。**実装済み**: 仮値10桁「0000000000」を設定（推測実装のため要確認）
4. **公費給付率**: **実装済み**: 簡易実装で固定値「0」を設定（推測実装のため要確認）
5. **計画単位数・限度額管理単位数**: データベースに該当フィールドなし。訪問看護では通常不要だが、仕様上は任意項目。**実装済み**: 空欄を設定

### 推奨対応

1. **事業所番号**: ✅ 実装済み（7桁の`facilityCode`を10桁にパディング）。推測実装のため要確認
2. **7111レコードの法別番号**: ✅ **実装済み**: 法別番号ごとに複数の7111レコードを出力するように実装済み。法別番号「0」（介護保険のみ）と各公費の法別番号ごとにグループ化し、それぞれの7111レコードを出力している
3. **居宅介護支援事業所番号**: ✅ 実装済み（仮値「0000000000」）。推測実装のため要確認
4. **公費給付率**: ⚠️ 簡易実装で固定値「0」。将来的に公費情報から計算するロジックが必要
5. **計画単位数・限度額管理単位数**: ✅ 実装済み（空欄を設定）

### 結論

**必須項目の約90%は出力可能**です。残りの10%については、デフォルト値の設定や仮値の設定により対応可能です。実装済みの項目のうち、推測で実装した部分については実際のデータと仕様を確認して調整が必要です。
