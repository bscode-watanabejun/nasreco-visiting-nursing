# 摘要欄の実装仕様

## 概要
摘要欄には、次のア～ウの表示項目を、**項目ごとに点線で区切って順に表示**する。
各表示項目の表示内容の基となるレコード及び項目の記録がない場合には表示しない。

---

## ア. 第二～第四公費 公費給付対象一部負担金情報

### CSVの記録例
```
KO,11111111,1111111,,3,5000,2000,1000
KO,22222222,2222222,,3,10000,4000,1000
KO,33333333,3333333,,3,15000,6000,500
```

### 出力紙レセプトの印字

**条件:** KOレコードが複数レコード記録され、2レコード目以降のKOレコードの「公費給付対象一部負担金」の記録がある場合、請求時及び決定時の「公費給付対象一部負担金」の記録内容を表示

```
公２
  ＜請求時＞
    公費給付対象：　（1,000円）
  ＜決定時＞
    公費給付対象：　（1,000円）

公３
  ＜請求時＞
    公費給付対象：　（500円）
  ＜決定時＞
    公費給付対象：　（500円）
```

---

## イ. 主治医情報（2人目以降）

### CSVの記録例
```
IH,13,1,0000001,△△クリニック,医師 太郎,20240601
IH,13,1,0000002,○○クリニック,医師 次郎,20240610
IH,13,1,0000003,▼▼クリニック,医師 三郎,20240620
```

### 出力紙レセプトの印字

**条件:** IHレコードが複数レコード記録された場合、2レコード目以降の記録内容を表示

**注意:** 医療機関コードは、IHレコードの「都道府県」「点数表」及び「コード」の記録内容を合成したコードを表示

```
＜主治医２＞
  医療機関コード；１３１００００００２
  医療機関名称；○○クリニック
  氏名；医師　次郎
  直近報告年月日；令和　６年　６月１０日

＜主治医３＞
  医療機関コード；１３１００００００３
  医療機関名称；▼▼クリニック
  氏名；医師　三郎
  直近報告年月日；令和　６年　６月２０日
```

### IHレコードのフィールド構成（推定）
| フィールド | 例 | 説明 |
|-----------|-----|------|
| レコード識別 | IH | 固定値 |
| 都道府県 | 13 | 都道府県コード |
| 点数表 | 1 | 点数表区分 |
| コード | 0000002 | 医療機関コード |
| 医療機関名称 | ○○クリニック | 名称 |
| 氏名 | 医師 次郎 | 医師名 |
| 直近報告年月日 | 20240610 | YYYYMMDD形式 |

---

## ウ. 摘要情報

### CSVの記録例（通常パターン）
```
KA,20240610,1,510000110,,5550,03,01,01
KA,20240610,1,510000110,,5550,03,01,01
KA,20240610,1,510000110,,5550,03,01,01
KA,20240610,1,510000210,,6550,03,01,01
```

### 出力紙レセプトの印字

| 区分 |  | 負担 | 名称 | 金額（円） | 日数（日） |
|------|--|------|------|-----------|-----------|
| 10 | 15 | 1 | 訪問看護基本療養費２（保健師、助産師又は看護師による場合（ハを除く。））（同一日に２人）（週３日目まで） | 5,550 | × 3 |
|  |  | 1 | 訪問看護基本療養費２（保健師、助産師又は看護師による場合（ハを除く。））（同一日に２人）（週４日目以降） | 6,550 | × 1 |

### 表示ルール

1. **「名称」欄**: 訪問看護療養費マスタにおいて、KAレコードの「訪問看護療養費コード」に記録されたコードに対応する「省略名称」を表示

2. **「区分」欄（2列構成）**: 
   - 訪問看護療養費マスタにおいて、KAレコードの「訪問看護療養費コード」に記録されたコードに対応する「レセプト表示欄」及び「レセプト表示項」の番号をそれぞれ表示
   - **左側の「区分」列に「レセプト表示欄」、右側の「区分」列に「レセプト表示項」を表示**
   - 同一番号の表示となる訪問看護療養費を連続して表示する場合は、同一の項目は省略する

3. **「負担」欄**:
   - 訪問看護療養費マスタから取得した値を表示（詳細は不明のため要確認）

4. **「日数（日）」欄**: 
   - 同一の「訪問看護療養費コード」が記録されたKAレコードが複数レコード記録された場合に、そのレコード数を表示
   - 日数の前に「×」を付けて表示（例: × 3）

5. **「金額（円）」欄**: 
   - KAレコードの「金額」に記録された値を表示

---

## 補足事項：特別地域訪問看護加算の特殊処理

### 概要
訪問看護療養費マスタにおいて、「金額識別」に「5：％加算」が設定された訪問看護療養費コード（現時点の訪問看護療養費マスタにおいては**"特別地域訪問看護加算"のみ**）が記録された場合の特殊処理。

### 処理ルール
- **加算元となる訪問看護基本療養費**を記録する訪問看護療養費レコードにおいて、**加算を含む金額**を記録
- **当該加算を記録する訪問看護療養費レコード**の金額には「**0**」を記録

### CSVの記録例
```
KA,20240610,1,510000110,,8325,03,01,01
KA,20240610,1,510002370,,0,,,
```

### 出力紙レセプトの印字

| 区分 |  | 負担 | 名称 | 金額（円） | 日数（日） |
|------|--|------|------|-----------|-----------|
| 10 | 15 | 1 | 訪問看護基本療養費２（保健師、助産師又は看護師による場合（ハを除く。））（同一日に２人）（週３日目まで）<br>特別地域訪問看護加算（訪問看護基本療養費） | 8,325 | × 1 |

### 表示ルール（特別地域訪問看護加算）
1. 訪問看護基本療養費及び特別地域訪問看護加算を**連続して表示**
2. **金額及び日数は、特別地域訪問看護加算の行に表示**
3. 「区分」欄については、**加算元となる訪問看護基本療養費に係る区分のみを表示**し、特別地域訪問看護加算に係る区分は表示しない

---

## 実装時の注意点

### 1. 出力セル範囲とレイアウト

#### セルの列構成
| 項目 | 列 | 説明 |
|------|-----|------|
| 区分（1列目） | P列 | レセプト表示欄 |
| 区分（2列目） | Q列 | レセプト表示項 |
| 負担 | R列 | 負担区分 |
| 名称 | S列 | 訪問看護療養費の省略名称 |
| 金額（円） | AG列 | 金額 |
| 日数（日） | AL列 | 日数 |

#### セルの行構成（各列あたり2行でセル結合）
| 行番号 | 開始行 | 終了行（結合） | 備考 |
|--------|--------|---------------|------|
| 1行目 | 43行目 | 44行目 | P43:P44結合、Q43:Q44結合、R43:R44結合、S43:S44結合、AG43:AG44結合、AL43:AL44結合 |
| 2行目 | 45行目 | 46行目 | P45:P46結合、Q45:Q46結合、R45:R46結合、S45:S46結合、AG45:AG46結合、AL45:AL46結合 |
| 3行目 | 47行目 | 48行目 | P47:P48結合、Q47:Q48結合、R47:R48結合、S47:S48結合、AG47:AG48結合、AL47:AL48結合 |
| 4行目 | 49行目 | 50行目 | P49:P50結合、Q49:Q50結合、R49:R50結合、S49:S50結合、AG49:AG50結合、AL49:AL50結合 |
| 5行目 | 51行目 | 52行目 | P51:P52結合、Q51:Q52結合、R51:R52結合、S51:S52結合、AG51:AG52結合、AL51:AL52結合 |
| 6行目 | 53行目 | 54行目 | P53:P54結合、Q53:Q54結合、R53:R54結合、S53:S54結合、AG53:AG54結合、AL53:AL54結合 |
| 7行目 | 55行目 | 56行目 | P55:P56結合、Q55:Q56結合、R55:R56結合、S55:S56結合、AG55:AG56結合、AL55:AL56結合 |
| 8行目 | 57行目 | 58行目 | P57:P58結合、Q57:Q58結合、R57:R58結合、S57:S58結合、AG57:AG58結合、AL57:AL58結合 |
| 9行目 | 59行目 | 60行目 | P59:P60結合、Q59:Q60結合、R59:R60結合、S59:S60結合、AG59:AG60結合、AL59:AL60結合 |
| 10行目 | 61行目 | 62行目 | P61:P62結合、Q61:Q62結合、R61:R62結合、S61:S62結合、AG61:AG62結合、AL61:AL62結合 |
| 11行目 | 63行目 | 64行目 | P63:P64結合、Q63:Q64結合、R63:R64結合、S63:S64結合、AG63:AG64結合、AL63:AL64結合 |
| 12行目 | 65行目 | 66行目 | P65:P66結合、Q65:Q66結合、R65:R66結合、S65:S66結合、AG65:AG66結合、AL65:AL66結合 |
| 13行目 | 67行目 | 68行目 | P67:P68結合、Q67:Q68結合、R67:R68結合、S67:S68結合、AG67:AG68結合、AL67:AL68結合 |
| 14行目 | 69行目 | 70行目 | P69:P70結合、Q69:Q70結合、R69:R70結合、S69:S70結合、AG69:AG70結合、AL69:AL70結合 |
| 15行目 | 71行目 | 72行目 | P71:P72結合、Q71:Q72結合、R71:R72結合、S71:S72結合、AG71:AG72結合、AL71:AL72結合 |

**合計出力可能行数**: 最大15行

#### セル範囲の簡易表現
- **全体範囲**: P43:AL71（ただしP, Q, R, S, AG, AL列のみ使用）
- **1行あたり**: 2行分を結合したセル
- **点線区切り**: 各表示項目（ア、イ、ウ）の間に点線を引く

### 2. 項目の区切り
- 各表示項目（ア、イ、ウ）は**点線で区切る**

### 3. 条件付き表示
- 各表示項目の表示内容の基となるレコード及び項目の記録がない場合には**表示しない**

### 4. データソース
- **訪問看護療養費マスタ**から以下の情報を取得する必要がある：
  - 省略名称
  - レセプト表示欄
  - レセプト表示項
  - 金額識別（％加算判定用）

### 5. KAレコードのフィールド構成（推定）
| フィールド | 例 | 説明 |
|-----------|-----|------|
| レコード識別 | KA | 固定値 |
| 訪問日 | 20240610 | YYYYMMDD形式 |
| （不明） | 1 | - |
| 訪問看護療養費コード | 510000110 | マスタ参照用 |
| （不明） | （空） | - |
| 金額 | 5550 | 療養費金額 |
| （不明） | 03 | - |
| （不明） | 01 | - |
| （不明） | 01 | - |

---

## 必要なマスタ情報

実装にあたり、以下のマスタデータへのアクセスが必要です：

1. **訪問看護療養費マスタ**
   - 訪問看護療養費コード（主キー）
   - 省略名称
   - レセプト表示欄
   - レセプト表示項
   - 金額識別（％加算判定用）

2. **日付フォーマット変換**
   - YYYYMMDD → 和暦表示（令和　６年　６月１０日）

3. **医療機関コード合成ロジック**
   - 都道府県 + 点数表 + コード → 合成コード（例：１３１００００００２）
