# 加算実装状況レポート

**作成日**: 2025-10-26
**システム**: 訪問看護管理システム

---

## 📊 実装状況サマリー

### 全体進捗

| システム | 実装済み | 未実装 | 進捗率 |
|---------|---------|--------|--------|
| **加算マスタ（bonus_master）** | 12/32項目 | 20/32項目 | **37.5%** |
| **特管マスタ（special_management）** | 6項目（完全稼働） | - | **100%** |
| **システム基盤** | 完全実装 | - | **100%** |

---

## 1. 加算マスタ（bonus_master）実装状況

### 1-1. 医療保険（18項目中6項目実装 - 33.3%）

| # | 加算名 | 実装状況 | 実装方法 | 備考 |
|---|--------|---------|---------|------|
| 1 | 緊急訪問看護加算 | ✅ 実装済み | monthly_14day_threshold | 月14日目で変動（2650円/2000円） |
| 2 | 難病等複数回訪問加算 | ❌ 未実装 | - | 1日2回/3回以上の区分が必要 |
| 3 | 長時間訪問看護加算 | ✅ 実装済み | duration_based | 90分超判定（5200円） |
| 4 | 乳幼児加算 | ✅ 実装済み | age_based | 6歳未満判定（1500円） |
| 5 | 複数名訪問看護加算 | ✅ 実装済み | fixed + field_not_empty | multipleVisitReasonフィールド判定 |
| 6 | 夜間・早朝/深夜訪問看護加算 | ✅ 実装済み | time_based | 時間帯別（4200円/2100円） |
| 7 | 特別地域訪問看護加算 | ❌ 未実装 | - | 地域マスタとの連携が必要 |
| 8 | 24時間対応体制加算 | ✅ 実装済み | facility flag | Phase 2-1実装（基本/負担軽減） |
| 9 | 退院時共同指導加算・特別管理指導加算 | ❌ 未実装 | - | 多職種連携記録の詳細化が必要 |
| 10 | 退院時支援指導加算 | ❌ 未実装 | - | 退院支援記録の詳細化が必要 |
| 11 | 在宅連携指導加算 | ❌ 未実装 | - | 月1回制限の実装が必要 |
| 12 | 在宅患者緊急時等カンファレンス | ❌ 未実装 | - | 月2回制限の実装が必要 |
| 13 | 精神科重症患者支援管理連携加算 | ❌ 未実装 | - | 精神科フラグの追加が必要 |
| 14 | 看護・介護職員連携強化加算 | ❌ 未実装 | - | 連携記録の詳細化が必要 |
| 15 | 専門管理加算 | ❌ 未実装 | - | 緩和ケア/褥瘡ケア/特定行為の区分が必要 |
| 16 | 訪問看護医療DX情報活用加算 | ❌ 未実装 | - | DX対応フラグの追加が必要 |
| 17 | 訪問看護ターミナルケア療養費 | ✅ 実装済み | fixed + is_terminal_care | ターミナルケアフラグ判定 |
| 18 | 訪問看護ベースアップ評価料 | ❌ 未実装 | - | Ⅰ/Ⅱ区分と施設フラグが必要 |

### 1-2. 介護保険（14項目中6項目実装 - 42.9%）

| # | 加算名 | 実装状況 | 実装方法 | 備考 |
|---|--------|---------|---------|------|
| 1 | 夜間・早朝加算/深夜加算 | ✅ 実装済み | time_based | 早朝6-8時/夜間18-22時/深夜22-6時 |
| 2 | 複数名訪問加算 | ❌ 未実装 | - | Ⅰ/Ⅱ区分が必要 |
| 3 | 長時間訪問看護加算 | ✅ 実装済み | duration_based | 90分以上判定 |
| 4 | 専門管理加算 | ❌ 未実装 | - | 専門分野の区分が必要 |
| 5 | 遠隔死亡診断補助加算 | ❌ 未実装 | - | 遠隔診断記録の追加が必要 |
| 6 | 初回加算（Ⅰ/Ⅱ） | ✅ 実装済み | is_first_visit_of_plan | 新規計画初回訪問フラグ判定 |
| 7 | 退院時共同指導加算 | ✅ 実装済み | is_discharge_date | 退院日当日訪問フラグ判定 |
| 8 | 看護・介護職員連携強化加算 | ❌ 未実装 | - | 連携記録の詳細化が必要 |
| 9 | 看護体制強化加算（Ⅰ/Ⅱ） | ❌ 未実装 | - | 施設体制フラグの追加が必要 |
| 10 | 口腔連携加算 | ❌ 未実装 | - | 歯科連携記録の追加が必要 |
| 11 | 緊急時訪問看護加算（Ⅰ/Ⅱ） | ✅ 実装済み | facility flag | Phase 2-1実装（基本/強化） |
| 12 | サービス提供体制強化加算（Ⅰ/Ⅱ） | ❌ 未実装 | - | 施設体制フラグの追加が必要 |
| 13 | ターミナルケア加算 | ✅ 実装済み | is_terminal_care | ターミナルケアフラグ判定 |
| 14 | 特別地域・中山間地域加算 | ❌ 未実装 | - | 地域マスタとの連携が必要 |

---

## 2. 特別管理加算（special_management_definitions）実装状況

### 2-1. 特管マスタの特徴

- **月額固定点数制**: 訪問ごとではなく月次で算定
- **カスタムフィールド対応**: 項目ごとに記録フィールドを自由に定義可能
- **完全独立システム**: bonus_masterとは別の管理体系

### 2-2. 医療保険 特別管理加算（6項目実装済み - 100%）

| # | 表示名 | 保険種別 | 月額点数 | カテゴリーコード | 実装状況 |
|---|--------|---------|---------|---------------|---------|
| 1 | 気管カニューレ | 医療 | 5,000円 | tracheostomy | ✅ 実装済み |
| 2 | 在宅酸素療法 | 医療 | 2,500円 | oxygen | ✅ 実装済み |
| 3 | 人工呼吸器 | 医療 | 2,500円 | ventilator | ✅ 実装済み |
| 4 | 中心静脈栄養 | 医療 | 2,500円 | tpn | ✅ 実装済み |
| 5 | 褥瘡管理(D3以上) | 医療 | 2,500円 | pressure_ulcer | ✅ 実装済み |
| 6 | 人工肛門 | 医療 | 2,500円 | artificial_anus | ✅ 実装済み |

### 2-3. 介護保険 特別管理加算

| 保険種別 | 月額単位数 | 実装状況 | 備考 |
|---------|-----------|---------|------|
| 介護 特別管理加算Ⅰ | 500単位 | ✅ システム対応済み | care_500 enum定義済み |
| 介護 特別管理加算Ⅱ | 250単位 | ✅ システム対応済み | care_250 enum定義済み |

**注**: 介護保険の具体的な特管項目データは追加登録が必要

---

## 3. システム基盤実装状況

### 3-1. データベーススキーマ（100%完了）

| テーブル | 実装状況 | 詳細 |
|---------|---------|------|
| bonus_master | ✅ 完全実装 | 加算マスタテーブル（lines 568-632） |
| bonus_calculation_history | ✅ 完全実装 | 計算履歴・監査証跡 |
| monthly_receipts | ✅ 完全実装 | 月次レセプトサマリ |
| special_management_definitions | ✅ 完全実装 | 特管マスタテーブル |
| special_management_fields | ✅ 完全実装 | 特管カスタムフィールド定義 |

### 3-2. 条件分岐パターン（8種類実装済み）

| パターン | 説明 | 実装状況 |
|---------|------|---------|
| monthly_14day_threshold | 月14日目で変動 | ✅ |
| building_occupancy | 同一建物入居者数で変動 | ✅ |
| time_based | 時間帯別点数 | ✅ |
| duration_based | 訪問時間長で変動 | ✅ |
| age_based | 年齢区分で変動 | ✅ |
| visit_count | 訪問回数で変動 | ✅ |
| combination_control | 併算定制御 | ✅ |
| custom | カスタムJSONルール | ✅ |

### 3-3. 条件評価エンジン（24種類実装済み）

#### Phase 1: 基本条件（3項目）

| 条件タイプ | 実装状況 | 用途 |
|-----------|---------|------|
| field_not_empty | ✅ | フィールド存在判定 |
| is_second_visit | ✅ | 同日2回目判定 |
| has_building | ✅ | 建物有無判定 |

#### Phase 2-A: 記録フラグ条件（12項目）

| 条件タイプ | 実装状況 | 用途 |
|-----------|---------|------|
| is_discharge_date | ✅ | 退院日当日訪問 |
| is_first_visit_of_plan | ✅ | 新規計画初回訪問 |
| has_collaboration_record | ✅ | 多職種連携記録 |
| is_terminal_care | ✅ | ターミナルケア |
| care_early_morning_time | ✅ | 早朝（6:00-8:00） |
| care_night_time | ✅ | 夜間（18:00-22:00） |
| care_late_night_time | ✅ | 深夜（22:00-6:00） |
| care_visit_duration_90plus | ✅ | 訪問90分以上 |
| field_equals | ✅ | フィールド値判定 |
| visit_duration_gte | ✅ | 訪問時間≥判定 |
| visit_duration_lt | ✅ | 訪問時間<判定 |
| age_lt / age_gte | ✅ | 年齢判定 |

#### Phase 2-1: 施設体制フラグ条件（4項目）

| 条件タイプ | 実装状況 | 用途 |
|-----------|---------|------|
| has_24h_support_system | ✅ | 24時間対応体制加算（基本） |
| has_24h_support_system_enhanced | ✅ | 24時間対応体制加算（負担軽減） |
| has_emergency_support_system | ✅ | 緊急時訪問看護加算（Ⅰ） |
| has_emergency_support_system_enhanced | ✅ | 緊急時訪問看護加算（Ⅱ） |

### 3-4. サーバーサイド計算エンジン（100%完了）

| コンポーネント | 実装状況 | ファイル |
|--------------|---------|---------|
| メイン計算エンジン | ✅ | server/bonus-engine.ts (1001行) |
| 条件評価器 | ✅ | 24種類の評価関数 |
| パターン評価器 | ✅ | 6種類のパターン処理 |
| バージョン自動選択 | ✅ | 訪問日ベース |
| 併算定チェック | ✅ | canCombineWith / cannotCombineWith |
| 計算履歴保存 | ✅ | bonus_calculation_history |

### 3-5. REST API（100%完了）

#### 加算マスタAPI

| エンドポイント | メソッド | 実装状況 | 詳細 |
|--------------|--------|---------|------|
| /api/bonus-masters | GET | ✅ | 一覧取得（保険種別・活動状態フィルタ） |
| /api/bonus-masters | POST | ✅ | 新規登録（期間重複チェック） |
| /api/bonus-masters/:id | PUT | ✅ | 更新（期間重複チェック） |
| /api/bonus-masters/:id | DELETE | ✅ | 削除（論理削除） |

#### 特管マスタAPI

| エンドポイント | メソッド | 実装状況 | 詳細 |
|--------------|--------|---------|------|
| /api/special-management-definitions | GET | ✅ | 一覧取得 |
| /api/special-management-definitions | POST | ✅ | 新規登録 |
| /api/special-management-definitions/:id | PUT | ✅ | 更新 |
| /api/special-management-definitions/:id | DELETE | ✅ | 削除 |

### 3-6. フロントエンドUI（100%完了）

| コンポーネント | 実装状況 | ファイル | 機能 |
|--------------|---------|---------|------|
| BonusMasterManagement | ✅ | client/src/components/ | 加算マスタ管理画面 |
| PredefinedConditionsDisplay | ✅ | 同上 | 適用条件の人間化表示 |
| SpecialManagementSettings | ✅ | 同上 | 特管マスタ管理画面 |

---

## 4. 実装フェーズ詳細

### Phase 1: 基本機能（完了）

| 項目 | 実装状況 | 完了日 |
|------|---------|--------|
| データベーススキーマ設計 | ✅ 完了 | - |
| 加算計算エンジン実装 | ✅ 完了 | - |
| 基本条件評価器（3種類） | ✅ 完了 | - |
| テストデータ登録（6項目） | ✅ 完了 | - |

### Phase 2-A: 記録フラグ対応（完了）

| 項目 | 実装状況 | 完了日 |
|------|---------|--------|
| nursing_recordsテーブルへのフラグ追加 | ✅ 完了 | - |
| 記録フラグ条件評価器（12種類） | ✅ 完了 | - |
| 時間帯判定機能 | ✅ 完了 | - |

### Phase 2-1: 施設体制フラグ対応（完了）

| 項目 | 実装状況 | 完了日 |
|------|---------|--------|
| facilitiesテーブルへのフラグ追加 | ✅ 完了 | 2025-10-24 |
| 施設体制条件評価器（4種類） | ✅ 完了 | 2025-10-24 |
| シードデータスクリプト | ✅ 完了 | 2025-10-24 |
| PredefinedConditionsDisplay更新 | ✅ 完了 | 2025-10-24 |

### Phase 3: 特管マスタ（完了）

| 項目 | 実装状況 | 完了日 |
|------|---------|--------|
| 特管マスタテーブル設計 | ✅ 完了 | - |
| カスタムフィールド機能 | ✅ 完了 | - |
| 管理画面UI | ✅ 完了 | - |
| 医療保険6項目登録 | ✅ 完了 | - |

### Phase 4: 診療報酬点数表完全対応（計画中）

| 項目 | 実装状況 | 優先度 |
|------|---------|--------|
| 医療保険残り12項目のマスタ登録 | 🚧 計画中 | ★★★ |
| 介護保険残り8項目のマスタ登録 | 🚧 計画中 | ★★★ |
| predefinedConditions詳細定義 | 🚧 計画中 | ★★★ |
| 統合テスト | 🚧 計画中 | ★★☆ |

### Phase 5: レセプト電子請求対応（計画中）

| 項目 | 実装状況 | 優先度 |
|------|---------|--------|
| 介護給付費請求書生成 | 🚧 計画中 | ★★☆ |
| 訪問看護療養費請求書生成 | 🚧 計画中 | ★★☆ |
| 算定要件チェックエンジン | 🚧 計画中 | ★★☆ |
| 加算漏れアラート機能 | 🚧 計画中 | ★☆☆ |

### Phase 6: 運用効率化・分析（計画中）

| 項目 | 実装状況 | 優先度 |
|------|---------|--------|
| レセプト分析ダッシュボード | 🚧 計画中 | ★☆☆ |
| 加算別取得率可視化 | 🚧 計画中 | ★☆☆ |
| レセコン連携API | 🚧 計画中 | ★☆☆ |

---

## 5. 未実装項目の実装要件

### 5-1. データベース拡張が必要な項目

| 加算名 | 必要な追加フィールド/テーブル |
|--------|------------------------|
| 難病等複数回訪問加算 | 訪問回数カウント機能 |
| 特別地域訪問看護加算 | 地域マスタテーブル、施設-地域紐付け |
| 在宅連携指導加算 | 月次加算取得履歴（月1回制限） |
| 在宅患者緊急時等カンファレンス | 月次加算取得履歴（月2回制限） |
| 精神科重症患者支援管理連携加算 | 患者精神科フラグ、連携記録詳細 |
| 看護・介護職員連携強化加算 | 連携記録詳細フィールド |
| 専門管理加算 | 専門分野区分（緩和ケア/褥瘡ケア/特定行為） |
| 訪問看護医療DX情報活用加算 | 施設DX対応フラグ |
| 訪問看護ベースアップ評価料 | 施設ベースアップフラグ（Ⅰ/Ⅱ） |
| 複数名訪問加算 | 複数名区分（Ⅰ/Ⅱ）詳細化 |
| 遠隔死亡診断補助加算 | 遠隔診断記録フィールド |
| 看護体制強化加算 | 施設体制フラグ（Ⅰ/Ⅱ） |
| 口腔連携加算 | 歯科連携記録フィールド |
| サービス提供体制強化加算 | 施設体制フラグ（Ⅰ/Ⅱ） |
| 特別地域・中山間地域加算 | 地域マスタテーブル |

### 5-2. ロジック拡張が必要な項目

| 加算名 | 必要なロジック |
|--------|---------------|
| 退院時共同指導加算・特別管理指導加算 | 医療機関との共同指導記録判定 |
| 退院時支援指導加算 | 退院支援計画書との連携 |
| 在宅連携指導加算 | 月1回制限チェック |
| 在宅患者緊急時等カンファレンス | 月2回制限チェック |

---

## 6. 主要ファイル一覧

### データベース・スキーマ

| ファイル | 行数 | 説明 |
|---------|------|------|
| /shared/schema.ts | 1357 | DBスキーマ定義（bonus_master: 568-632, special_management: 516-540） |
| /test-bonus-data.sql | 221 | テストデータ（医療6項目+介護1項目） |
| /server/seed-special-management.ts | - | 特管マスタシードデータ |

### サーバーサイド

| ファイル | 行数 | 説明 |
|---------|------|------|
| /server/bonus-engine.ts | 1001 | 加算計算エンジン（24評価器+6パターン） |
| /server/routes.ts | 6413-6631 | REST API（加算マスタCRUD） |
| /server/seed-bonus-master-phase2-1.ts | 164 | Phase 2-1シードデータ |

### クライアント

| ファイル | 説明 |
|---------|------|
| /client/src/components/BonusMasterManagement.tsx | 加算マスタ管理画面 |
| /client/src/components/SpecialManagementSettings.tsx | 特管マスタ管理画面 |

### ドキュメント

| ファイル | 行数 | 説明 |
|---------|------|------|
| /docs/implementation-roadmap.md | 593 | 実装ロードマップ |
| /docs/点数計算の仕組み.md | 232 | ビジネスロジック説明 |
| /docs/加算マスタ適用条件表示機能.md | 331 | UI実装仕様 |

---

## 7. バージョン管理・改定対応

### 実装済み機能

| 機能 | 実装状況 | 詳細 |
|------|---------|------|
| バージョンフィールド | ✅ | version VARCHAR(20) - '2024', '2026'等 |
| 有効期間管理 | ✅ | validFrom, validTo DATE型 |
| 期間重複チェック | ✅ | API登録時に自動検証 |
| 訪問日ベース自動選択 | ✅ | 訪問日に有効なバージョンを自動適用 |

### 改定対応手順（例：2026年4月改定）

1. 既存加算の `validTo` を '2026-03-31' に設定
2. 新バージョン（version: '2026'）として加算マスタを新規登録
3. `validFrom: '2026-04-01'` に設定
4. 点数・条件を改定内容に合わせて設定
5. システムは訪問日に基づいて自動的に適切なバージョンを適用

---

## 8. 今後の推奨実装スケジュール

### 短期（1-2週間）

| タスク | 優先度 | 想定工数 |
|--------|--------|---------|
| 医療保険残り12項目のシードデータ作成 | ★★★ | 2-3日 |
| 介護保険残り8項目のシードデータ作成 | ★★★ | 1-2日 |
| predefinedConditions定義 | ★★★ | 2-3日 |
| 統合テスト（全加算） | ★★☆ | 2日 |

### 中期（3-4週間）

| タスク | 優先度 | 想定工数 |
|--------|--------|---------|
| PredefinedConditionsDisplay拡張（Phase 4対応） | ★★☆ | 2日 |
| 月次回数制限機能（在宅連携指導加算等） | ★★☆ | 3-4日 |
| 地域マスタ実装（特別地域加算対応） | ★☆☆ | 5日 |
| 専門分野区分実装（専門管理加算対応） | ★☆☆ | 3日 |

### 長期（Phase 5-6）

| タスク | 優先度 | 想定工数 |
|--------|--------|---------|
| レセプト電子請求フォーマット対応 | ★★☆ | 2週間 |
| 算定要件チェックエンジン強化 | ★★☆ | 1週間 |
| 加算漏れアラート機能 | ★☆☆ | 1週間 |
| 分析ダッシュボード | ★☆☆ | 2週間 |

---

## 9. 重要な注意事項

### システム設計上の重要ポイント

1. **加算マスタと特管マスタは別システム**
   - 加算マスタ：訪問ごとに判定・計算
   - 特管マスタ：月額固定、患者属性として管理
   - **混同しないこと**

2. **併算定制御**
   - `canCombineWith`: 併算定可能リスト
   - `cannotCombineWith`: 併算定不可リスト
   - 両方nullの場合は制限なし

3. **バージョン管理の重要性**
   - 診療報酬改定ごとに新バージョン作成
   - 古いバージョンは削除せず `validTo` で期間管理
   - システムが訪問日に基づいて自動選択

4. **型安全性の維持**
   - `/shared/schema.ts` で型定義
   - Zod バリデーション活用
   - TypeScript strict mode 必須

---

## 10. 参考リンク

- [実装ロードマップ](/docs/implementation-roadmap.md)
- [点数計算の仕組み](/docs/点数計算の仕組み.md)
- [加算マスタ適用条件表示機能](/docs/加算マスタ適用条件表示機能.md)
- [データベーススキーマ](/shared/schema.ts)
- [加算計算エンジン](/server/bonus-engine.ts)

---

**最終更新**: 2025-10-26
**レポート作成者**: Claude (AI Assistant)
