# 訪問看護アプリ必須機能 実装ロードマップ

> **作成日**: 2025-10-04
> **目的**: 訪問看護アプリとして実運用可能な状態にするための必須機能実装計画

---

## 📊 現状分析サマリー

### 実装状況
- **基本業務フロー**: 30-40% 実装済み（患者管理、スケジュール、訪問記録の基本）
- **法令遵守・保険請求機能**: 60-70% 未実装
- **総合評価**: このままでは実運用開始不可（法令違反、保険請求不可）

### 既に実装済みの主要機能 ✅
1. 患者基本情報管理（氏名、連絡先、既往歴、介護度、保険種別）
2. 訪問スケジュール管理（予定登録、担当割当、ステータス管理）
3. 訪問記録作成（バイタルサイン、観察事項、実施ケア、添付ファイル）
4. 訪問記録の下書き・完成・承認フロー
5. バイタルサイン推移グラフ
6. スタッフ管理・権限管理
7. マルチテナント対応（施設・企業階層）

---

## ❌ 完全に欠けている必須機能（優先度順）

### 【最優先】法令遵守・保険請求に必須

#### 1. 訪問看護指示書管理機能 ⭐⭐⭐
**必須理由**: 医療法・健康保険法で医師の指示書なしでは訪問看護を実施できない

**実装内容**:
- 訪問看護指示書テーブル新設
  - 医師名、医療機関、指示期間（開始日・終了日）
  - 指示内容、疾病名、週訪問回数上限
  - PDF/画像ファイルパス
- 患者詳細画面に指示書セクション追加
- 有効期限アラート機能（30日前/7日前）
- PDF/画像アップロード機能（既存添付機能を流用）

**業務への影響**:
- 指示書の有効期限管理ができず、法令違反のリスク
- 保険請求時に指示書の有無確認ができず、請求不可能
- 医師からの指示内容を確認できず、医療安全上の問題

---

#### 2. 保険証情報管理 ⭐⭐⭐
**必須理由**: レセプト請求に保険者番号・被保険者番号が必須

**実装内容**:
- 保険証テーブル新設（医療保険証・介護保険証を別管理）
  - 保険者番号、被保険者番号、記号・番号
  - 有効期間（開始日・終了日）
  - 負担割合（1割/2割/3割）
- 患者登録・編集画面に保険証入力セクション追加
- 有効期限アラート機能
- 複数保険証の履歴管理

**業務への影響**:
- 保険請求ができない
- 患者負担金計算ができない

---

#### 3. レセプト作成機能（基本版） ⭐⭐⭐
**必須理由**: 診療報酬・介護報酬請求のための書類作成が業務の根幹

**実装内容**:
- 月次訪問実績集計API
  - 患者別・月別の訪問回数集計
  - 訪問時間の合計計算
  - 加算の自動集計
- 加算自動計算ロジック
  - 複数回訪問加算（1日2回以上）
  - 長時間訪問加算（90分以上）
  - 緊急訪問加算
  - 同一建物減算（patients.buildingId活用）
- レセプトデータCSV出力
  - 患者基本情報 + 保険証情報 + 訪問実績
  - 医療保険/介護保険別の集計
  - 手動でレセプトソフトに取り込める形式

**業務への影響**:
- 月末の請求業務が完全に手作業となり、膨大な時間が必要
- 加算の計算ミスによる減収リスク

---

#### 4. 訪問看護計画書・報告書管理機能 ⭐⭐⭐
**必須理由**: 介護保険では計画書・報告書の作成が保険請求の要件

**実装内容**:
- 訪問看護計画書テーブル新設
  - 看護目標、計画内容、評価期間
  - 作成日、次回評価日
- 訪問看護報告書テーブル新設
  - 実施内容、評価、ケアマネへの報告事項
  - 報告日、報告先（ケアマネ）
- シンプルなフォーム入力UI
- PDF出力機能（テンプレート使用）

**業務への影響**:
- 計画書未作成で介護報酬請求不可
- ケアマネージャーとの情報連携ができず、多職種連携不全

---

#### 5. 医師・ケアマネージャー情報管理 ⭐⭐⭐
**必須理由**: 訪問看護は医師の指示・ケアマネとの連携が必須

**実装内容**:
- 医療機関マスタテーブル新設
  - 病院名、診療科、医師名
  - 連絡先（電話、FAX、メール）
  - 住所
- ケアマネージャーマスタテーブル新設
  - 事業所名、担当者名
  - 連絡先（電話、FAX、メール）
  - 住所
- 患者テーブルに主治医ID、ケアマネIDフィールド追加
- 患者詳細画面に医師・ケアマネ情報表示

**業務への影響**:
- 主治医への報告ができない（法令違反）
- ケアマネとの情報共有不可
- 緊急時の連絡先がわからない

---

#### 6. 同意書・契約書管理機能 ⭐⭐
**必須理由**: 介護保険法・医療法で契約書締結が義務

**実装内容**:
- 契約書テーブル新設
  - 契約日、契約種別（重要事項説明書、サービス利用契約書等）
  - 有効期間、PDFファイルパス
- 同意書管理
  - 個人情報利用同意、医療行為同意等
- PDF保管・閲覧機能

**業務への影響**:
- 契約書未締結で保険請求不可
- 個人情報保護法上の同意取得記録がない

---

### 【高優先】業務効率・データ整合性

#### 7. 訪問予定と訪問実績の完全な紐付け ⭐⭐
**現状の問題点**:
- `schedules`テーブルと`nursingRecords`テーブルの紐付けが弱い
- スケジュールの完了ステータス更新はあるが、双方向の関連が不明瞭

**実装内容**:
- `nursingRecords.scheduleId`フィールド追加
- スケジュール完了時の自動記録作成促進UI
- 予定外訪問の明確な記録方法（scheduleId = null）
- 記録未作成のスケジュール一覧表示

---

## ⚠️ 部分的に実装されているが改善が必要な機能

### 1. 加算管理の強化 ⭐⭐⭐
**現状**:
- 複数回訪問理由、緊急訪問理由、長時間訪問理由のテキストフィールドあり
- 90分超の自動検知ロジックあり

**不足内容**:
- 加算の自動計算がない（理由を記録するだけで、実際の点数計算なし）
- 同一建物減算の自動判定がない（buildingIdはあるが未活用）
- 月間の加算合計や上限チェックがない

**改善内容**:
- 訪問記録保存時の加算自動判定・計算
- 月次集計での加算合計表示
- 加算上限チェック（複数回訪問加算は週3日まで等）

---

### 2. 特別管理加算の詳細記録 ⭐⭐
**現状**:
- `patients.isCritical`フィールドで重要患者フラグあり

**不足内容**:
- 特別管理加算の具体的な対象項目（在宅悪性腫瘍、点滴注射、中心静脈栄養等）の詳細記録がない
- 特別管理加算の継続理由・開始日・終了日の記録がない

**改善内容**:
- 特別管理加算テーブル（または既存additionalPaymentsテーブル活用）
- 対象項目の詳細記録（複数選択可能）
- 月次の算定可否判定ロジック

---

### 3. 入院・ショートステイ状態管理の強化 ⭐
**現状**:
- `patients.isInHospital`、`patients.isInShortStay`フィールドあり

**不足内容**:
- 入院・ショートステイ期間の記録がない
- 状態変更履歴がない

**改善内容**:
- 入院・ショートステイ履歴テーブル（開始日、終了日、施設名）
- スケジュール作成時の自動警告

---

### 4. 繰り返しスケジュール自動生成 ⭐
**現状**:
- `schedules.isRecurring`、`recurrencePattern`、`recurrenceEndDate`フィールドあり

**不足内容**:
- 繰り返しスケジュールの自動生成機能がない

**改善内容**:
- 週次・隔週・月次パターンでの一括スケジュール生成
- 繰り返しスケジュールの一括編集・削除機能

---

## 🎯 実装フェーズ計画

### **Phase 1: 法令遵守・保険請求の最低限実装**
**期間**: 2-3週間
**目標**: 実運用開始可能な状態にする

**実装項目**:
1. 訪問看護指示書管理 ⭐⭐⭐
2. 保険証情報管理 ⭐⭐⭐
3. 医師・ケアマネージャー情報管理 ⭐⭐⭐
4. 基本的な加算計算ロジック ⭐⭐

**データベーススキーマ変更**:
- `doctor_orders`テーブル新設（訪問看護指示書）
- `insurance_cards`テーブル新設（保険証情報）
- `medical_institutions`テーブル新設（医療機関マスタ）
- `care_managers`テーブル新設（ケアマネージャーマスタ）
- `patients`テーブル拡張（doctorId, careManagerId追加）

---

### **Phase 2: レセプト基盤構築**
**期間**: 2-3週間
**目標**: 月次請求業務を半自動化

**実装項目**:
1. 月次訪問実績集計機能 ⭐⭐⭐
2. レセプト基本データ出力（CSV） ⭐⭐⭐
3. 訪問看護計画書・報告書（簡易版） ⭐⭐

**データベーススキーマ変更**:
- `care_plans`テーブル新設（訪問看護計画書）
- `care_reports`テーブル新設（訪問看護報告書）
- `nursingRecords`テーブル拡張（加算計算結果フィールド追加）

---

### **Phase 3: 業務効率化**
**期間**: 1-2週間
**目標**: 日常業務のストレス軽減

**実装項目**:
1. 契約書・同意書管理（簡易版） ⭐
2. スケジュールと記録の完全紐付け改善 ⭐⭐
3. 繰り返しスケジュール自動生成 ⭐

**データベーススキーマ変更**:
- `contracts`テーブル新設（契約書・同意書）
- `nursingRecords`テーブル拡張（scheduleId追加）

---

## 📋 データベーススキーマ変更サマリー

### 新規テーブル（8つ）
1. `doctor_orders` - 訪問看護指示書
2. `insurance_cards` - 保険証情報
3. `medical_institutions` - 医療機関マスタ
4. `care_managers` - ケアマネージャーマスタ
5. `care_plans` - 訪問看護計画書
6. `care_reports` - 訪問看護報告書
7. `contracts` - 契約書・同意書
8. `hospitalization_history` - 入院・ショートステイ履歴（オプション）

### 既存テーブル拡張
- `patients`:
  - `doctorId` (varchar, FK to medical_institutions)
  - `careManagerId` (varchar, FK to care_managers)
- `nursingRecords`:
  - `scheduleId` (varchar, FK to schedules)
  - `calculatedPoints` (integer, 算定点数)
  - `appliedBonuses` (json, 適用加算の詳細)

---

## ⏱️ 実装期間の見積もり

| フェーズ | 期間 | 累積期間 |
|---------|------|----------|
| Phase 1 | 2-3週間 | 2-3週間 |
| Phase 2 | 2-3週間 | 4-6週間 |
| Phase 3 | 1-2週間 | 5-8週間 |

**合計**: 5-8週間で実用最小限の訪問看護アプリが完成

---

## 🚀 実装後の到達状態

### Phase 1完了後
- ✅ 法令遵守: 指示書管理で適法運用可能
- ✅ 多職種連携: 医師・ケアマネ情報で情報共有可能
- ✅ 基本加算: 主要な加算の自動判定

### Phase 2完了後
- ✅ 保険請求: 月次集計→CSV出力で請求業務を80%効率化
- ✅ 計画書・報告書: 介護保険請求の要件を満たす
- ✅ レセプト基盤: 外部レセプトソフトへの連携準備完了

### Phase 3完了後
- ✅ 業務フロー: スケジュール→訪問→記録→報告の完全サイクル
- ✅ 契約管理: コンプライアンス対応
- ✅ 効率化: 繰り返し作業の自動化

---

## 📌 重要な注意事項

### Phase 1から始めるべき理由
1. **指示書なし = 訪問看護できない**（法律違反）
2. **保険証なし = 収益化不可能**（ビジネス不成立）
3. **医師情報なし = 報告義務違反**（法律違反）
4. これらがないと「記録を作る機能」があっても実運用できない

### 付加価値機能（AI、音声入力等）は後回し
- 基盤がないと付加価値機能を実装しても意味がない
- まずは「使える訪問看護アプリ」を完成させることが最優先

---

## 🔄 次のステップ

1. Phase 1の詳細設計（データベーススキーマ定義）
2. Phase 1の実装開始
3. Phase 1の機能テスト・ユーザーフィードバック収集
4. フィードバックを反映してPhase 2へ

---

**最終更新**: 2025-10-04
**ステータス**: Phase 1 実装準備中
